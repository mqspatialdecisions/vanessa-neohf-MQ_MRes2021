---
title: "Coral Core Calibration and Frequency Analysis"
author: "Vanessa Hui Fen Neo"
date: "`r lubridate::today()`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, results = FALSE)
```

```{r Loading_Packages, include = FALSE}
library(tidyverse)
library(lubridate)
library(patchwork)
library(tsibble)
library(TSclust)
library(mgcv)
library(broom)
library(kableExtra)
library(equatiomatic)
```


```{r Browse_Island, message=FALSE, include = FALSE}

##BRS05

Browse_05_CCI <- read_csv(here::here("data_raw", "CCI_BRS05.csv")) 
Browse_05_CCI <- Browse_05_CCI %>% 
  mutate(sst = as.numeric(str_sub(Browse_05_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>% #select only useful columns 
  as_tsibble(index = date) # convert them to tsibble

Browse_05_CCore <- read_csv(here::here("data_raw", "CCore_BRS05_BRS07_Year_Month.csv"), n_max = 349) %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = str_c(year, month, sep = "-")) %>% #stringing year and month
  mutate(date = yearmonth(date)) %>% #converting date column fr chr to date format
  select(data_type, date, `BRS05 Sr/Ca [mmol/mol]`) %>%  #select only useful columns 
  as_tsibble(index = date) # convert them to tsibble 

Browse_05_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_SCOTTSS1.csv")) %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst)  %>% #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Browse_05_NOAA <- read_csv(here::here("data_raw", "NOAA_BRS05_SST.csv")) %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Browse_05_GCM <- read_csv(here::here("data_raw/GCM", "GCM_BRS05.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)


dat <- as_tibble(Browse_05_CCI) %>% 
  add_row(as_tibble(Browse_05_NOAA)) %>% 
  # only few data points when logger data is included: add_row(as_tibble(Browse_05_Logger)) %>% 
  add_row(as_tibble(Browse_05_CCore) %>% 
            rename(sst = `BRS05 Sr/Ca [mmol/mol]`)) %>% 
  add_row(as_tibble(Browse_05_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "browse_CCI",
                      data_type == "Logger" ~ "browse_Logger", 
                      data_type == "NOAA" ~ "browse_NOAA",
                      data_type == "Coral Core" ~ "browse_coral_core",
                      data_type == "GCM" ~ "browse_GCM",
                      TRUE ~ data_type))

BRS05_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "BRS05")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with CCI than NOAA
ggplot(BRS05_joint, aes(x = browse_coral_core, y = browse_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at BRS05", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# decreasing trend with curvature. 
# gam1 <- gam(browse_NOAA ~ s(browse_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 3.841 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(browse_NOAA ~ 1 + browse_coral_core + I(browse_coral_core^2), 
         # data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.175
# use linear model

NOAA_BRS05 <- lm(browse_NOAA ~ 1 + browse_coral_core, 
          data = BRS05_joint)
# summary(lm1)

# repeat for CCI 
ggplot(BRS05_joint, aes(x = browse_coral_core, y = browse_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at BRS05", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with a slight curvature. 
# gam2 <- gam(browse_CCI ~ s(browse_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 3.727 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(browse_CCI ~ 1 + browse_coral_core + I(browse_coral_core^2), 
        #  data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.204
# use linear model

CCI_BRS05 <- lm(browse_CCI ~ 1 + browse_coral_core, 
          data = BRS05_joint)
# summary(lm2)


#modelsummary::modelsummary(list(NOAA_BRS05, CCI_BRS05))

##BRS07

Browse_07_CCI <- read_csv(here::here("data_raw", "CCI_BRS07.csv"))
Browse_07_CCI <- Browse_07_CCI %>% 
  mutate(sst = as.numeric(str_sub(Browse_07_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>% #select only useful columns 
  as_tsibble(index = date) # convert them to tsibble

Browse_07_CCore <- read_csv(here::here("data_raw", "CCore_BRS05_BRS07_Year_Month.csv"), n_max = 740) %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = str_c(year, month, sep = "-")) %>% #stringing year and month
  mutate(date = yearmonth(date)) %>% #converting date column fr chr to date format
  select(data_type, date, `BRS07 Sr/Ca [mmol/mol]`) %>%  #select only useful columns 
  as_tsibble(index = date) # convert them to tsibble 

Browse_07_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_SCOTTSS1.csv")) %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst)  %>% #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Browse_07_NOAA <- read_csv(here::here("data_raw", "NOAA_BRS07_SST.csv")) %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Browse_07_GCM <- read_csv(here::here("data_raw/GCM", "GCM_BRS07.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(Browse_07_CCI) %>% 
  add_row(as_tibble(Browse_07_NOAA)) %>% 
  # only 9 points are available when including logger data: add_row(as_tibble(Browse_07_Logger)) %>% 
  add_row(as_tibble(Browse_07_CCore) %>% 
            rename(sst = `BRS07 Sr/Ca [mmol/mol]`)) %>% 
  add_row(as_tibble(Browse_07_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "browse_CCI",
                      data_type == "Logger" ~ "browse_Logger", 
                      data_type == "NOAA" ~ "browse_NOAA",
                      data_type == "Coral Core" ~ "browse_coral_core",
                      data_type == "GCM" ~ "browse_GCM",
                      TRUE ~ data_type))

BRS07_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "BRS07")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with CCI than NOAA 
ggplot(BRS07_joint, aes(x = browse_coral_core, y = browse_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at BRS07", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with a slight curvature. 
# gam1 <- gam(browse_NOAA ~ s(browse_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 3.039 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(browse_NOAA ~ 1 + browse_coral_core + I(browse_coral_core^2), 
         # data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.146
# use linear model

NOAA_BRS07 <- lm(browse_NOAA ~ 1 + browse_coral_core, 
          data = BRS07_joint)
# summary(lm1)

# repeat for CCI 
ggplot(BRS07_joint, aes(x = browse_coral_core, y = browse_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at BRS07", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with a slight curvature. 
# gam2 <- gam(browse_CCI ~ s(browse_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 3.166 so linear + quadratic should give a good approx to the trend

CCI_BRS07 <- lm(browse_CCI ~ 1 + browse_coral_core + I(browse_coral_core^2), 
          data = BRS07_joint)
# summary(lm2)

# p-value for quadratic is significant, keep quadratic model

#modelsummary::modelsummary(list(NOAA_BRS07, CCI_BRS07))
```



```{r Cocos_Keeling_Island, message = FALSE, include = FALSE}
##DAR Long
DARL_CCI <- read_csv(here::here("data_raw", "CCI_DARL.csv"))
DARL_CCI <- DARL_CCI %>% 
  mutate(sst = as.numeric(str_sub(DARL_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DARL_CCore <- read_csv(here::here("data_raw", "CCore_DAR_Long_Year_Month.csv"))
DARL_CCore <- DARL_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `Sr/Ca`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DARL_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_100THSITE.csv"))
DARL_Logger <- DARL_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DARL_NOAA <- read_csv(here::here("data_raw", "NOAA_DAR_Long_SST.csv"))
DARL_NOAA <- DARL_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DARL_GCM <- read_csv(here::here("data_raw/GCM", "GCM_DAR_Long.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(DARL_CCI) %>% 
  add_row(as_tibble(DARL_NOAA)) %>% 
  #less than 10 points if logger data is included : add_row(as_tibble(DARL_Logger)) %>% 
  add_row(as_tibble(DARL_CCore) %>% 
            rename(sst = `Sr/Ca`)) %>% 
  add_row(as_tibble(DARL_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "Cocos_CCI",
                      data_type == "Logger" ~ "Cocos_Logger", 
                      data_type == "NOAA" ~ "Cocos_NOAA",
                      data_type == "Coral Core" ~ "Cocos_coral_core",
                      data_type == "GCM" ~ "Cocos_GCM",
                      TRUE ~ data_type))

DARL_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "DARL")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with CCI than NOAA 
ggplot(DARL_joint, aes(x = Cocos_coral_core, y = Cocos_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at DAR Long", x = "Coral Core Sr/Ca Ratio", y = "NOAA")

# linear decreasing trend

# gam1 <- gam(Cocos_NOAA ~ s(Cocos_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 1.881 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(Cocos_NOAA ~ 1 + Cocos_coral_core + I(Cocos_coral_core^2), 
         # data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.322
# use linear model

NOAA_DARL <- lm(Cocos_NOAA ~ 1 + Cocos_coral_core, 
          data = DARL_joint)
# summary(lm1)

# repeat for CCI 
ggplot(DARL_joint, aes(x = Cocos_coral_core, y = Cocos_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at DAR Long", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend 
# gam2 <- gam(Cocos_CCI ~ s(Cocos_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 1.969 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(Cocos_CCI ~ 1 + Cocos_coral_core + I(Cocos_coral_core^2), 
         # data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.506
# use linear model

CCI_DARL <- lm(Cocos_CCI ~ 1 + Cocos_coral_core, 
          data = DARL_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_DARL, CCI_DARL))

##DAR3
DAR3_CCI <- read_csv(here::here("data_raw", "CCI_DAR3.csv"))
DAR3_CCI <- DAR3_CCI %>% 
  mutate(sst = as.numeric(str_sub(DAR3_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DAR3_CCore <- read_csv(here::here("data_raw", "CCore_DAR3_Year_Month.csv"))
DAR3_CCore <- DAR3_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `Sr/Ca`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DAR3_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_100THSITE.csv"))
DAR3_Logger <- DAR3_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DAR3_NOAA <- read_csv(here::here("data_raw", "NOAA_DAR3_SST.csv"))
DAR3_NOAA <- DAR3_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

DAR3_GCM <- read_csv(here::here("data_raw/GCM", "GCM_DAR3.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(DAR3_CCI) %>% 
  add_row(as_tibble(DAR3_NOAA)) %>% 
  #less than 10 points if logger data is included : add_row(as_tibble(DAR3_Logger)) %>% 
  add_row(as_tibble(DAR3_CCore) %>% 
            rename(sst = `Sr/Ca`)) %>% 
  add_row(as_tibble(DAR3_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "Cocos_CCI",
                      data_type == "Logger" ~ "Cocos_Logger", 
                      data_type == "NOAA" ~ "Cocos_NOAA",
                      data_type == "Coral Core" ~ "Cocos_coral_core",
                      data_type == "GCM" ~ "Cocos_GCM",
                      TRUE ~ data_type))

DAR3_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "DAR3")

#GGally::ggpairs(dat_joint)
## coral core is slightly more align with NOAA over CCI 
ggplot(DAR3_joint, aes(x = Cocos_coral_core, y = Cocos_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at DAR3", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with a slight curvature. 
# gam1 <- gam(Cocos_NOAA ~ s(Cocos_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 1.881 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(Cocos_NOAA ~ 1 + Cocos_coral_core + I(Cocos_coral_core^2), 
        #  data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.322
# use linear model

NOAA_DAR3 <- lm(Cocos_NOAA ~ 1 + Cocos_coral_core, 
          data = DAR3_joint)
# summary(lm1)

# repeat for CCI 
ggplot(DAR3_joint, aes(x = Cocos_coral_core, y = Cocos_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at DAR3", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with a slight curvature. 
# gam2 <- gam(Cocos_CCI ~ s(Cocos_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 1.969 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(Cocos_CCI ~ 1 + Cocos_coral_core + I(Cocos_coral_core^2), 
#          data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.506
# use linear model

CCI_DAR3 <- lm(Cocos_CCI ~ 1 + Cocos_coral_core, 
          data = DAR3_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_DAR3, CCI_DAR3))


```



```{r Ningaloo_Reef, message = FALSE, include = FALSE}
##Tantabiddi 13TNT
Ningaloo_13TNT_CCI <- read_csv(here::here("data_raw", "CCI_Tantabiddi.csv"))
Ningaloo_13TNT_CCI <- Ningaloo_13TNT_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_13TNT_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13TNT_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_13TNT_Year_Month.csv"))
Ningaloo_13TNT_CCore <- Ningaloo_13TNT_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = as_date(date)) %>% 
  select(data_type, date, `Sr/Ca`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13TNT_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_TANDFL1.csv"))
Ningaloo_13TNT_Logger <- Ningaloo_13TNT_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13TNT_NOAA <- read_csv(here::here("data_raw", "NOAA_Tantabiddi_13TNT_SST.csv"))
Ningaloo_13TNT_NOAA <- Ningaloo_13TNT_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13TNT_GCM <- read_csv(here::here("data_raw/GCM", "GCM_Tantabiddi.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(Ningaloo_13TNT_CCI) %>% 
  add_row(as_tibble(Ningaloo_13TNT_NOAA)) %>% 
  # only 13 data points available if logger data is included in analysis: add_row(as_tibble(Ningaloo_13TNT_Logger)) %>% 
  add_row(as_tibble(Ningaloo_13TNT_CCore) %>% 
            rename(sst = `Sr/Ca`)) %>% 
  add_row(as_tibble(Ningaloo_13TNT_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      # only 13 data points if logger data is included: data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      data_type == "GCM" ~ "ningaloo_GCM",
                      TRUE ~ data_type))

Tantabiddi_13TNT_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "13TNT")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with NOAA than CCI 
ggplot(Tantabiddi_13TNT_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 13TNT", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with a slight curvature. 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 2.677 so linear + quadratic should give a good approx to the trend

NOAA_Tantabiddi_13TNT <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
          data = Tantabiddi_13TNT_joint)
# summary(lm1)

# repeat for CCI 
ggplot(Tantabiddi_13TNT_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 13TNT", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with a slight curvature. 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 2.724 so linear + quadratic should give a good approx to the trend

CCI_Tantabiddi_13TNT <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
          data = Tantabiddi_13TNT_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_Tantabiddi_13TNT, CCI_Tantabiddi_13TNT))


##Tantabiddi 08TNT
Ningaloo_08TNT_CCI <- read_csv(here::here("data_raw", "CCI_Tantabiddi.csv"))
Ningaloo_08TNT_CCI <- Ningaloo_08TNT_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_08TNT_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08TNT_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_08TNT_Year_Month.csv"))
Ningaloo_08TNT_CCore <- Ningaloo_08TNT_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = as_date(date)) %>% 
  select(data_type, date, `Sr/Ca`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08TNT_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_TANDFL1.csv"))
Ningaloo_08TNT_Logger <- Ningaloo_08TNT_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08TNT_NOAA <- read_csv(here::here("data_raw", "NOAA_Tantabiddi_08TNT_SST.csv"))
Ningaloo_08TNT_NOAA <- Ningaloo_08TNT_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08TNT_GCM <- read_csv(here::here("data_raw/GCM", "GCM_Tantabiddi.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)


dat <- as_tibble(Ningaloo_08TNT_CCI) %>% 
  add_row(as_tibble(Ningaloo_08TNT_NOAA)) %>% 
  # no values if logger data is added here: add_row(as_tibble(Ningaloo_08TNT_Logger)) %>% 
  add_row(as_tibble(Ningaloo_08TNT_CCore) %>% 
            rename(sst = `Sr/Ca`)) %>% 
  add_row(as_tibble(Ningaloo_08TNT_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      data_type == "GCM" ~ "ningaloo_GCM",
                      TRUE ~ data_type))

Tantabiddi_08TNT_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "08TNT")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with NOAA over CCI 
ggplot(Tantabiddi_08TNT_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 08TNT", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 2.477 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.564
# use linear model instead

NOAA_Tantabiddi_08TNT <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core, 
          data = Tantabiddi_08TNT_joint)
# summary(lm1)

# repeat for CCI 
ggplot(Tantabiddi_08TNT_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 08TNT", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 2.391 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.329
# use linear model instead

CCI_Tantabiddi_08TNT <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core, 
          data = Tantabiddi_08TNT_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_Tantabiddi_08TNT, CCI_Tantabiddi_08TNT))


##Bundegi 13BND
Ningaloo_13BND_CCI <- read_csv(here::here("data_raw", "CCI_Bundegi.csv"))
Ningaloo_13BND_CCI <- Ningaloo_13BND_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_13BND_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13BND_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_13BND_Year_Month.csv"))
Ningaloo_13BND_CCore <- Ningaloo_13BND_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = as_date(date)) %>% 
  select(data_type, date, `Sr/Ca`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13BND_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_BUNDFL1.csv"))
Ningaloo_13BND_Logger <- Ningaloo_13BND_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13BND_NOAA <- read_csv(here::here("data_raw", "NOAA_Bundegi_13BND_SST.csv"))
Ningaloo_13BND_NOAA <- Ningaloo_13BND_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_13BND_GCM <- read_csv(here::here("data_raw/GCM", "GCM_Bundegi.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)


dat <- as_tibble(Ningaloo_13BND_CCI) %>% 
  add_row(as_tibble(Ningaloo_13BND_NOAA)) %>% 
  # only 10 observations when logger data is added : add_row(as_tibble(Ningaloo_13BND_Logger)) %>%
  add_row(as_tibble(Ningaloo_13BND_CCore) %>% 
            rename(sst = `Sr/Ca`)) %>% 
  add_row(as_tibble(Ningaloo_13BND_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      data_type == "GCM" ~ "ningaloo_GCM",
                      TRUE ~ data_type))

Bundegi_13BND_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "13BND")

#GGally::ggpairs(dat_joint)
## coral core is much more aligned with NOAA over CCI 
ggplot(Bundegi_13BND_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 13BND", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with a slight curvature for NOAA and coral core. 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 2.283 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
          # data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.195
# use linear model instead

NOAA_Bundegi_13BND <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core, 
          data = Bundegi_13BND_joint)
# summary(lm1)

# repeat for CCI 
ggplot(Bundegi_13BND_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 13BND", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 1.672 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
         # data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.665
# use linear model instead

CCI_Bundegi_13BND <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core, 
          data = Bundegi_13BND_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_Bundegi_13BND, CCI_Bundegi_13BND))


##Bundegi 08BND
Ningaloo_08BND_CCI <- read_csv(here::here("data_raw", "CCI_Bundegi.csv"))
Ningaloo_08BND_CCI <- Ningaloo_08BND_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_08BND_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08BND_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_08BND_Year_Month.csv"))
Ningaloo_08BND_CCore <- Ningaloo_08BND_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = as_date(date)) %>% 
  select(data_type, date, `Sr/Ca`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08BND_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_BUNDFL1.csv"))
Ningaloo_08BND_Logger <- Ningaloo_08BND_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08BND_NOAA <- read_csv(here::here("data_raw", "NOAA_Bundegi_08BND_SST.csv"))
Ningaloo_08BND_NOAA <- Ningaloo_08BND_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_08BND_GCM <- read_csv(here::here("data_raw/GCM", "GCM_Bundegi.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(Ningaloo_08BND_CCI) %>% 
  add_row(as_tibble(Ningaloo_08BND_NOAA)) %>% 
  #no values if logger data is included : add_row(as_tibble(Ningaloo_08BND_Logger)) %>% 
  add_row(as_tibble(Ningaloo_08BND_CCore) %>% 
            rename(sst = `Sr/Ca`)) %>% 
  add_row(as_tibble(Ningaloo_08BND_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      data_type == "GCM" ~ "ningaloo_GCM",
                      TRUE ~ data_type))

Bundegi_08BND_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "08BND")

#GGally::ggpairs(dat_joint)
## coral core is more aligned with NOAA over CCI 
ggplot(Bundegi_08BND_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 08BND", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with curvature. 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 3.657 so linear + quadratic should give a good approx to the trend

NOAA_Bundegi_08BND <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
          data = Bundegi_08BND_joint)
# summary(lm1)

# significant p-value for quadratic

# repeat for CCI 
ggplot(Bundegi_08BND_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at 08BND", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with curvature. 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 2.88 so linear + quadratic should give a good approx to the trend

CCI_Bundegi_08BND <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
          data = Bundegi_08BND_joint)
# summary(lm2)

# significant p-value for quadratic

#modelsummary::modelsummary(list(NOAA_Bundegi_08BND, CCI_Bundegi_08BND))


##TNT

Ningaloo_TNT_CCI <- read_csv(here::here("data_raw", "CCI_TNT.csv"))
Ningaloo_TNT_CCI <- Ningaloo_TNT_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_TNT_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_TNT_Year_Month.csv"))
Ningaloo_TNT_CCore <- Ningaloo_TNT_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = as_date(date)) %>% 
  select(data_type, date, `d18O`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_TANDFL1.csv"))
Ningaloo_TNT_Logger <- Ningaloo_TNT_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT_NOAA <- read_csv(here::here("data_raw", "NOAA_TNT_SST.csv"))
Ningaloo_TNT_NOAA <- Ningaloo_TNT_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

dat <- as_tibble(Ningaloo_TNT_CCI) %>% 
  add_row(as_tibble(Ningaloo_TNT_NOAA)) %>% 
  # no data is available when logger data is added: add_row(as_tibble(Ningaloo_TNT_Logger)) %>% 
  add_row(as_tibble(Ningaloo_TNT_CCore) %>% 
            rename(sst = `d18O`)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      TRUE ~ data_type))

TNT_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "TNT")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with CCI than NOAA
ggplot(TNT_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at TNT", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with a slight curvature. 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 3.138 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
          # data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.160
# use linear model instead

NOAA_TNT <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core, 
          data = TNT_joint)
# summary(lm1)

# repeat for CCI 
ggplot(TNT_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at TNT", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with a slight curvature. 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 3.056 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
#          data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.258
# use linear model instead

CCI_TNT <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core, 
          data = TNT_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_TNT, CCI_TNT))

##TNT07C
##Only annual coral core data

Ningaloo_TNT07C_CCI <- read_csv(here::here("data_raw", "CCI_TNT07C.csv"))
Ningaloo_TNT07C_CCI <- Ningaloo_TNT07C_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_TNT07C_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT07C_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_TNT07C_year.csv"))

Ningaloo_TNT07C_CCore <- Ningaloo_TNT07C_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(month = "01") %>% 
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `Tantabiddi Sr/Ca`) %>% 
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT07C_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_TANTABIDDI_SL1.csv"))
Ningaloo_TNT07C_Logger <- Ningaloo_TNT07C_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT07C_NOAA <- read_csv(here::here("data_raw", "NOAA_TNT07C_SST.csv"))
Ningaloo_TNT07C_NOAA <- Ningaloo_TNT07C_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_TNT07C_GCM <- read_csv(here::here("data_raw/GCM", "GCM_TNT07C.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)


dat <- as_tibble(Ningaloo_TNT07C_CCI) %>% 
  add_row(as_tibble(Ningaloo_TNT07C_NOAA)) %>% 
  # no data is available when logger data is added: add_row(as_tibble(Ningaloo_TNT07C_Logger)) %>% 
  add_row(as_tibble(Ningaloo_TNT07C_CCore) %>% 
            rename(sst = `Tantabiddi Sr/Ca`)) %>% 
  add_row(as_tibble(Ningaloo_TNT07C_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      data_type == "GCM" ~ "ningaloo_GCM",
                      TRUE ~ data_type))

TNT07C_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "TNT07C")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with NOAA over CCI 
ggplot(TNT07C_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at TNT07C", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 1.237 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
         # data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.312
# use linear model

NOAA_TNT07C <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core, 
          data = TNT07C_joint)
# summary(lm1)

# repeat for CCI 
ggplot(TNT07C_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at TNT07C", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 1.139 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
         # data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.726
# use linear model

CCI_TNT07C <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core, 
          data = TNT07C_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_TNT07C, CCI_TNT07C))

##BUN05A
##Only annual coral core data

Ningaloo_BUN05A_CCI <- read_csv(here::here("data_raw", "CCI_BUN05A.csv"))
Ningaloo_BUN05A_CCI <- Ningaloo_BUN05A_CCI %>% 
  mutate(sst = as.numeric(str_sub(Ningaloo_BUN05A_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_BUN05A_CCore <- read_csv(here::here("data_raw", "CCore_Ningaloo_BUN05A_year.csv"))
Ningaloo_BUN05A_CCore <- Ningaloo_BUN05A_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(month = "01") %>% 
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `Bundegi Sr/Ca`) %>% 
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_BUN05A_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_BUNDEGI_BR.csv"))
Ningaloo_BUN05A_Logger <- Ningaloo_BUN05A_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_BUN05A_NOAA <- read_csv(here::here("data_raw", "NOAA_BUN05A_SST.csv"))
Ningaloo_BUN05A_NOAA <- Ningaloo_BUN05A_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Ningaloo_BUN05A_GCM <- read_csv(here::here("data_raw/GCM", "GCM_BUN05A.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(Ningaloo_BUN05A_CCI) %>% 
  add_row(as_tibble(Ningaloo_BUN05A_NOAA)) %>% 
  # no data is available when logger data is added: add_row(as_tibble(Ningaloo_BUN05A_Logger)) %>% 
  add_row(as_tibble(Ningaloo_BUN05A_CCore) %>% 
            rename(sst = `Bundegi Sr/Ca`)) %>% 
  add_row(as_tibble(Ningaloo_BUN05A_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "ningaloo_CCI",
                      data_type == "Logger" ~ "ningaloo_Logger", 
                      data_type == "NOAA" ~ "ningaloo_NOAA",
                      data_type == "Coral Core" ~ "ningaloo_coral_core",
                      data_type == "GCM" ~ "ningaloo_GCM",
                      TRUE ~ data_type))

BUN05A_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "BUN05A")

#GGally::ggpairs(dat_joint)
## coral core is more aligned with CCI than NOAA 
ggplot(BUN05A_joint, aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at BUN05A", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend 
# gam1 <- gam(ningaloo_NOAA ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 1.032 so quadratic might not give a good approx to the trend

# lm1 <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
        #  data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.610
# use linear model

NOAA_BUN05A <- lm(ningaloo_NOAA ~ 1 + ningaloo_coral_core, 
          data = BUN05A_joint)
# summary(lm1)

# repeat for CCI 
ggplot(BUN05A_joint, aes(x = ningaloo_coral_core, y = ningaloo_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at BUN05A", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend 
# gam2 <- gam(ningaloo_CCI ~ s(ningaloo_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 1.221 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core + I(ningaloo_coral_core^2), 
        #  data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.816
# use linear model

CCI_BUN05A <- lm(ningaloo_CCI ~ 1 + ningaloo_coral_core, 
          data = BUN05A_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_BUN05A, CCI_BUN05A))

```



```{r Houtman_Abrolhos_Islands, message = FALSE, include = FALSE}
##Wallabi Island
Wallabi_Island_CCI <- read_csv(here::here("data_raw", "CCI_Wallabi_Island.csv"))
Wallabi_Island_CCI <- Wallabi_Island_CCI %>% 
  mutate(sst = as.numeric(str_sub(Wallabi_Island_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Wallabi_Island_CCore <- read_csv(here::here("data_raw", "CCore_H_Abrol_Wallabi_Year_Month.csv"))
Wallabi_Island_CCore <- Wallabi_Island_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `d18O`) %>%     #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Wallabi_Island_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_NTHFISHFL1.csv"))
Wallabi_Island_Logger <- Wallabi_Island_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

Wallabi_Island_NOAA <- read_csv(here::here("data_raw", "NOAA_Wallabi_Island_SST.csv"))
Wallabi_Island_NOAA <- Wallabi_Island_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

dat <- as_tibble(Wallabi_Island_CCI) %>% 
  add_row(as_tibble(Wallabi_Island_NOAA)) %>% 
  # no available data if logger data is included : add_row(as_tibble(Wallabi_Island_Logger)) %>% 
  add_row(as_tibble(Wallabi_Island_CCore) %>% 
            rename(sst = `d18O`)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "HAbrol_CCI",
                      data_type == "Logger" ~ "HAbrol_Logger", 
                      data_type == "NOAA" ~ "HAbrol_NOAA",
                      data_type == "Coral Core" ~ "HAbrol_coral_core",
                      TRUE ~ data_type))

Wallabi_Island_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "Wallabi Island")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with CCI than NOAA 
ggplot(Wallabi_Island_joint, aes(x = HAbrol_coral_core, y = HAbrol_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at Wallabi Island", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# trend is explained by a curvature. 
# gam1 <- gam(HAbrol_NOAA ~ s(HAbrol_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 3.398 so linear + quadratic should give a good approx to the trend

NOAA_Wallabi_Island <- lm(HAbrol_NOAA ~ 1 + HAbrol_coral_core + I(HAbrol_coral_core^2), 
          data = Wallabi_Island_joint)
# summary(lm1)

# p-value for quadratic is significant

# repeat for CCI 
ggplot(Wallabi_Island_joint, aes(x = HAbrol_coral_core, y = HAbrol_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at Wallabi Island", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# trend is explained by curvature. 
# gam2 <- gam(HAbrol_CCI ~ s(HAbrol_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 2.975 so linear + quadratic should give a good approx to the trend

CCI_Wallabi_Island <- lm(HAbrol_CCI ~ 1 + HAbrol_coral_core + I(HAbrol_coral_core^2), 
          data = Wallabi_Island_joint)
# summary(lm2)

# p-value for quadratic is significant

#modelsummary::modelsummary(list(NOAA_Wallabi_Island, CCI_Wallabi_Island))

##HAB10A d18O Proxy
##Only annual coral core data

HAB10A_d18O_CCI <- read_csv(here::here("data_raw", "CCI_HAB10A.csv"))
HAB10A_d18O_CCI <- HAB10A_d18O_CCI %>% 
  mutate(sst = as.numeric(str_sub(HAB10A_d18O_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB10A_d18O_CCore <- read_csv(here::here("data_raw", "CCore_H_Abrol_HAB_year.csv"))

HAB10A_d18O_CCore <- HAB10A_d18O_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(month = "01") %>% 
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `HAB10A d18O`) %>% 
  as_tsibble(index = date) # convert them to tsibble

HAB10A_d18O_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_NTHFISHFL1.csv"))
HAB10A_d18O_Logger <- HAB10A_d18O_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB10A_d18O_NOAA <- read_csv(here::here("data_raw", "NOAA_HAB10A_d18O_Proxy_SST.csv"))
HAB10A_d18O_NOAA <- HAB10A_d18O_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

dat <- as_tibble(HAB10A_d18O_CCI) %>% 
  add_row(as_tibble(HAB10A_d18O_NOAA)) %>% 
  # no available data if logger data is included : add_row(as_tibble(HAB10A_d18O_Logger)) %>% 
  add_row(as_tibble(HAB10A_d18O_CCore) %>% 
            rename(sst = `HAB10A d18O`)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "HAbrol_CCI",
                      data_type == "Logger" ~ "HAbrol_Logger", 
                      data_type == "NOAA" ~ "HAbrol_NOAA",
                      data_type == "Coral Core" ~ "HAbrol_coral_core",
                      TRUE ~ data_type))

HAB10A_d18O_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "HAB10A d18O")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with NOAA than CCI 
ggplot(HAB10A_d18O_joint, aes(x = HAbrol_coral_core, y = HAbrol_NOAA)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at HAB10A d18O", x = "Coral Core Sr/Ca Ratio", y = "NOAA")
# linear decreasing trend with a slight curvature. 
# gam1 <- gam(HAbrol_NOAA ~ s(HAbrol_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf = 1.16 so linear + quadratic should give a good approx to the trend

# lm1 <- lm(HAbrol_NOAA ~ 1 + HAbrol_coral_core + I(HAbrol_coral_core^2), 
#          data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.0657
# use linear model

NOAA_HAB10A_d18O <- lm(HAbrol_NOAA ~ 1 + HAbrol_coral_core, 
          data = HAB10A_d18O_joint)
# summary(lm1)

# repeat for CCI 
ggplot(HAB10A_d18O_joint, aes(x = HAbrol_coral_core, y = HAbrol_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at HAB10A d18O", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend with a slight curvature. 
# gam2 <- gam(HAbrol_CCI ~ s(HAbrol_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 0.9356 so quadratic model might not give a good approx to the trend

# lm2 <- lm(HAbrol_CCI ~ 1 + HAbrol_coral_core + I(HAbrol_coral_core^2), 
#          data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.272
# use linear model

CCI_HAB10A_d18O <- lm(HAbrol_CCI ~ 1 + HAbrol_coral_core, 
          data = HAB10A_d18O_joint)
# summary(lm2)

#modelsummary::modelsummary(list(NOAA_HAB10A_d18O, CCI_HAB10A_d18O))

##HAB05B d18O Proxy
##Only annual coral core data

HAB05B_d18O_CCI <- read_csv(here::here("data_raw", "CCI_HAB05B.csv"))
HAB05B_d18O_CCI <- HAB05B_d18O_CCI %>% 
  mutate(sst = as.numeric(str_sub(HAB05B_d18O_CCI$`mean temperature deg C`, 3, 7))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB05B_d18O_CCore <- read_csv(here::here("data_raw", "CCore_H_Abrol_HAB_year.csv"))

HAB05B_d18O_CCore <- HAB05B_d18O_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(month = "01") %>% 
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `HAB05B d18O`) %>% 
  as_tsibble(index = date) # convert them to tsibble

HAB05B_d18O_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_NTHFISHFL1.csv"))
HAB05B_d18O_Logger <- HAB05B_d18O_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB05B_d18O_NOAA <- read_csv(here::here("data_raw", "NOAA_HAB05B_d18O_Proxy_SST.csv"))
HAB05B_d18O_NOAA <- HAB05B_d18O_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

##HAB10A Sr/Ca Proxy
##Only annual coral core data

HAB10A_SrCa_CCI <- read_csv(here::here("data_raw", "CCI_HAB10A.csv"))
HAB10A_SrCa_CCI <- HAB10A_SrCa_CCI %>% 
  mutate(sst = as.numeric(str_sub(HAB10A_SrCa_CCI$`mean temperature deg C`, 3, 13))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB10A_SrCa_CCore <- read_csv(here::here("data_raw", "CCore_H_Abrol_HAB_year.csv"))

HAB10A_SrCa_CCore <- HAB10A_SrCa_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(month = "01") %>% 
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `HAB10A Sr/Ca`) %>% 
  as_tsibble(index = date) # convert them to tsibble

HAB10A_SrCa_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_NTHFISHFL1.csv"))
HAB10A_SrCa_Logger <- HAB10A_SrCa_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB10A_SrCa_NOAA <- read_csv(here::here("data_raw", "NOAA_HAB10A_SrCa_Proxy_SST.csv"))
HAB10A_SrCa_NOAA <- HAB10A_SrCa_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

##HAB05B SrCa Proxy
##Only annual coral core data

HAB05B_SrCa_CCI <- read_csv(here::here("data_raw", "CCI_HAB05B.csv"))
HAB05B_SrCa_CCI <- HAB05B_SrCa_CCI %>% 
  mutate(sst = as.numeric(str_sub(HAB05B_SrCa_CCI$`mean temperature deg C`, 3, 7))) %>%  #remove punctuation [[ and ]] from temperature data
  select(-`mean temperature deg C`) %>%  #remove column with [[ and ]]
  mutate(data_type = "CCI") %>%  #prepare data for binding with other data types
  rename(date = daily_date) %>%  #prepare data for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB05B_SrCa_CCore <- read_csv(here::here("data_raw", "CCore_H_Abrol_HAB_year.csv"))
HAB05B_SrCa_CCore <- HAB05B_SrCa_CCore %>% 
  mutate(data_type = "Coral Core") %>% #prepare data for binding with other data types
  mutate(month = "01") %>% 
  mutate(date = str_c(year, month, sep = "-")) %>% 
  mutate(date = ym(date)) %>% 
  select(data_type, date, `HAB05B Sr/Ca`) %>% 
  as_tsibble(index = date) # convert them to tsibble

HAB05B_SrCa_Logger <- read_csv(here::here("data_raw", "Logger_Avg_Daily_SST_NTHFISHFL1.csv"))
HAB05B_SrCa_Logger <- HAB05B_SrCa_Logger %>% 
  rename(sst = mean_SST) %>% #prepare data for binding with other data types
  mutate(data_type = "Logger") %>% #prepare data for binding with other data types
  select(data_type, date, sst) %>%   #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB05B_SrCa_NOAA <- read_csv(here::here("data_raw", "NOAA_HAB05B_SrCa_Proxy_SST.csv"))
HAB05B_SrCa_NOAA <- HAB05B_SrCa_NOAA %>% 
  mutate(data_type = "NOAA") %>%  #prepare data for binding with other data types
  select(-date) %>% #remove monthly date column
  rename(date = Date) %>% #rename daily date column to prepare for binding with other data types
  select(data_type, date, sst) %>%  #select only useful columns
  as_tsibble(index = date) # convert them to tsibble

HAB05B_SrCa_GCM <- read_csv(here::here("data_raw/GCM", "GCM_HAB10AB.csv")) %>% 
  mutate(data_type = "GCM", date = ymd(as.Date(Time))) %>% 
  rename(sst = tos) %>% 
  select(data_type, date, sst) %>% 
  as_tsibble(index = date)

dat <- as_tibble(HAB05B_SrCa_CCI) %>% 
  add_row(as_tibble(HAB05B_SrCa_NOAA)) %>% 
  # no available data if logger data is included : add_row(as_tibble(HAB05B_SrCa_Logger)) %>% 
  add_row(as_tibble(HAB05B_SrCa_CCore) %>% 
            rename(sst = `HAB05B Sr/Ca`)) %>% 
  add_row(as_tibble(HAB05B_SrCa_GCM)) %>% 
  mutate(data_type = 
           case_when( data_type == "CCI" ~ "HAbrol_CCI",
                      data_type == "Logger" ~ "HAbrol_Logger", 
                      data_type == "NOAA" ~ "HAbrol_NOAA",
                      data_type == "Coral Core" ~ "HAbrol_coral_core",
                      data_type == "GCM" ~ "HAbrol_GCM",
                      TRUE ~ data_type))

HAB05B_SrCa_joint <- dat %>% 
  pivot_wider(names_from = data_type, values_from = sst) %>% 
  drop_na() %>% 
  mutate(Site = "HAB05B SrCa")

#GGally::ggpairs(dat_joint)
## coral core is slightly more aligned with CCI than NOAA
#ggplot(HAB05B_SrCa_joint, aes(x = HAbrol_coral_core, y = HAbrol_NOAA)) + 
#  geom_point() + 
#  geom_smooth(method = "gam")
# linear and slight decreasing trend
# gam1 <- gam(HAbrol_NOAA ~ s(HAbrol_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam1)
# summary(gam1)
# edf is 0.5599 LOW!

# lm1 <- lm(HAbrol_NOAA ~ 1 + HAbrol_coral_core + I(HAbrol_coral_core^2), 
#          data = dat_joint)
# summary(lm1)

# p-value for quadratic is 0.0828
# use linear model

# lm1 <- lm(HAbrol_NOAA ~ 1 + HAbrol_coral_core, 
#          data = dat_joint)
# summary(lm1)

# p-value for linear model is not significant as well

# repeat for CCI 
ggplot(HAB05B_SrCa_joint, aes(x = HAbrol_coral_core, y = HAbrol_CCI)) + 
  geom_point() + 
  geom_smooth(method = "gam") %>% 
  labs(title = "Sea Surface Temperature at HAB05B Sr/Ca", x = "Coral Core Sr/Ca Ratio", y = "CCI")
# linear decreasing trend
# gam2 <- gam(HAbrol_CCI ~ s(HAbrol_coral_core, bs = "cs"), data = dat_joint, method = "REML")
# plot(gam2)
# summary(gam2)
# edf = 0.9579 so linear + quadratic should give a good approx to the trend

# lm2 <- lm(HAbrol_CCI ~ 1 + HAbrol_coral_core + I(HAbrol_coral_core^2), 
#          data = dat_joint)
# summary(lm2)

# p-value for quadratic is 0.217
# use linear model

CCI_HAB05B_SrCa <- lm(HAbrol_CCI ~ 1 + HAbrol_coral_core, 
          data = HAB05B_SrCa_joint)
# summary(lm2)

# p-value for linear model is significant

#modelsummary::modelsummary(list(CCI_HAB05B_SrCa))
```




\newpage
```{r binding_data}

Browse <- rbind(BRS05_joint, BRS07_joint)
Cocos_Keeling <- rbind(DARL_joint, DAR3_joint)
Ningaloo <- rbind(Tantabiddi_13TNT_joint, Tantabiddi_08TNT_joint, Bundegi_13BND_joint, Bundegi_08BND_joint, TNT07C_joint, BUN05A_joint)
HAbrol <- HAB05B_SrCa_joint


```


\newpage
```{r Browse_island_Plots_Table}
Browse_Plot_NOAA <- Browse %>% 
  ggplot(aes(x = browse_coral_core, y = browse_NOAA)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Browse Island NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA") +
  facet_wrap("Site")

Browse_Plot_CCI <- Browse %>% 
  ggplot(aes(x = browse_coral_core, y = browse_CCI)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Browse Island CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI") +
  facet_wrap("Site")

Browse_Plot_NOAA / Browse_Plot_CCI

C_Browse_Plot_NOAA <- Browse %>% 
  ggplot(aes(x = browse_coral_core, y = browse_NOAA, color = Site)) +
  geom_smooth() +
  labs(title = "Browse Island NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA", caption = "[Range of R Square values is from 0.497 to 0.570]")

C_Browse_Plot_CCI <- Browse %>% 
  ggplot(aes(x = browse_coral_core, y = browse_CCI, color = Site)) +
  geom_smooth() +
  labs(title = "Browse Island CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI", caption = "[Range of R Square values is from 0.568 to 0.622]")

C_Browse_Plot_NOAA / C_Browse_Plot_CCI 


```
\newpage

```{r Cocos_Keeling_Plots_Table}
Cocos_Keeling_Plot_NOAA <- Cocos_Keeling %>% 
  ggplot(aes(x = Cocos_coral_core, y = Cocos_NOAA)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Cocos Keeling Island NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA") +
  facet_wrap("Site")

Cocos_Keeling_Plot_CCI <- Cocos_Keeling %>% 
  ggplot(aes(x = Cocos_coral_core, y = Cocos_CCI)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Cocos Keeling Island CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI") +
  facet_wrap("Site")

Cocos_Keeling_Plot_NOAA / Cocos_Keeling_Plot_CCI

C_Cocos_Plot_NOAA <- Cocos_Keeling %>% 
  ggplot(aes(x = Cocos_coral_core, y = Cocos_NOAA, color = Site)) +
  geom_smooth() +
  labs(title = "Cocos Keeling Island NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA", caption = "[R Square values for both sites are 0.188]")

C_Cocos_Plot_CCI <- Cocos_Keeling %>% 
  ggplot(aes(x = Cocos_coral_core, y = Cocos_CCI, color = Site)) +
  geom_smooth() +
  labs(title = "Cocos Keeling Island CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI", caption = "[R Square values for both sites are 0.244]")

C_Cocos_Plot_NOAA / C_Cocos_Plot_CCI
```
\newpage
```{r Ningaloo_Plots_Table}
Ningaloo_Plot_NOAA <- Ningaloo %>% 
  ggplot(aes(x = ningaloo_coral_core, y = ningaloo_NOAA)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Ningaloo Reef NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA") +
  facet_wrap("Site")

Ningaloo_Plot_CCI <- Ningaloo %>% 
  ggplot(aes(x = ningaloo_coral_core, y = ningaloo_CCI)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Ningaloo Reef CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI") +
  facet_wrap("Site")


Ningaloo_Plot_NOAA 
Ningaloo_Plot_CCI


C_Ningaloo_Plot_NOAA <- Ningaloo %>% 
  ggplot(aes(x = ningaloo_coral_core, y = ningaloo_NOAA, color = Site)) +
  geom_smooth() +
  labs(title = "Ningaloo Reef NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA", caption = "[Range of R Square values is from 0.631 to 0.839]")

C_Ningaloo_Plot_CCI <- Ningaloo %>% 
  ggplot(aes(x = ningaloo_coral_core, y = ningaloo_CCI, color = Site)) +
  geom_smooth() +
  labs(title = "Ningaloo Reef CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI", caption = "[Range of R Square values is from 0.320 to 0.668]")

C_Ningaloo_Plot_NOAA / C_Ningaloo_Plot_CCI


```
\newpage
```{r Houtman_Abrolhos_Plots_Table, include = FALSE}
HAbrol_Plot_NOAA <- HAbrol %>% 
  ggplot(aes(x = HAbrol_coral_core, y = HAbrol_NOAA)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Houtman Abrolhos NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA") +
  facet_wrap("Site")

HAbrol_Plot_CCI <- HAbrol %>% 
  ggplot(aes(x = HAbrol_coral_core, y = HAbrol_CCI)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Houtman Abrolhos CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI") +
  facet_wrap("Site")

HAbrol_Plot_NOAA / HAbrol_Plot_CCI

C_HAbrol_Plot_NOAA <- HAbrol %>% 
  ggplot(aes(x = HAbrol_coral_core, y = HAbrol_NOAA, color = Site)) +
  geom_smooth() +
  labs(title = "Houtman Abrolhos NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA", caption = "[Range of R Square values is from 0.155 to 0.282]")

C_HAbrol_Plot_CCI <- HAbrol %>% 
  ggplot(aes(x = HAbrol_coral_core, y = HAbrol_CCI, color = Site)) +
  geom_smooth() +
  labs(title = "Houtman Abrolhos CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI", caption = "[Range of R Square values is from 0.142 to 0.336]") 

C_HAbrol_Plot_NOAA / C_HAbrol_Plot_CCI

Wallabi_Plot_NOAA <- Wallabi_Island_joint %>% 
  ggplot(aes(x = HAbrol_coral_core, y = HAbrol_NOAA, color = Site)) +
  geom_smooth() +
  labs(title = "Wallabi Island NOAA SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "NOAA", caption = "R Square value is 0.282")

Wallabi_Plot_CCI <- Wallabi_Island_joint %>% 
  ggplot(aes(x = HAbrol_coral_core, y = HAbrol_CCI, color = Site)) +
  geom_smooth() +
  labs(title = "Wallabi Island CCI SST and Coral Core Proxy", x = "Coral Core Sr/Ca Ratio", y = "CCI", caption = "R Square value is 0.336")

Wallabi_Plot_NOAA / Wallabi_Plot_NOAA
```
\newpage
\begin{landscape}
```{r Tables}

modelsummary::modelsummary(list("BRS05" = NOAA_BRS05, "BRS07" = NOAA_BRS07, "DARL" = NOAA_DARL, "DAR3" = NOAA_DAR3, "13TNT" = NOAA_Tantabiddi_13TNT, "08TNT" = NOAA_Tantabiddi_08TNT, "13BND" = NOAA_Bundegi_13BND, "08BND" = NOAA_Bundegi_08BND), title = "NOAA", coef_omit = "(Intercept)", coef_rename = c("browse_coral_core" = "L_Browse", "Cocos_coral_core" = "L_Cocos", "ningaloo_coral_core" = "L_Ningaloo", "I(ningaloo_coral_core^2)" = "Q_Ningaloo"), gof_omit = "BIC|Log.Lik.|F", output = 'kableExtra') %>% 
  kable_styling(position = "center", full_width = T) %>% 
  column_spec(column = 1, color = "purple") %>% 
  add_header_above(c(" " = 1, "Browse" = 2, "Cocos Keeling" = 2, "Ningaloo" = 4))

modelsummary::modelsummary(list("BRS05" = CCI_BRS05, "BRS07" = CCI_BRS07, "DARL" = CCI_DARL, "DAR3" = CCI_DAR3, "13TNT" = CCI_Tantabiddi_13TNT, "08TNT" = CCI_Tantabiddi_08TNT, "13BND" = CCI_Bundegi_13BND, "08BND" = CCI_Bundegi_08BND), title = "CCI", coef_omit = "(Intercept)", coef_rename = c("browse_coral_core" = "L_Browse", "I(browse_coral_core^2)" = "Q_Browse", "Cocos_coral_core" = "L_Cocos", "ningaloo_coral_core" = "L_Ningaloo", "I(ningaloo_coral_core^2)" = "Q_Ningaloo"), gof_omit = "BIC|Log.Lik.|F", output = 'kableExtra') %>% 
  kable_styling(position = "center", full_width = T) %>% 
  column_spec(column = 1, color = "purple") %>% 
  add_header_above(c(" " = 1, "Browse" = 2, "Cocos Keeling" = 2, "Ningaloo" = 4))

```
\end{landscape}

## Frequency Analysis - Spectral Analysis of Time Series for Sr/Ca Coral Proxy sites
\newpage
\begin{center}

Monthly Coral Core Proxy Sites -
Period of 1 represents 1 year

\end{center}

\newpage
**BRS05**  

```{r Frequency_Analysis_Browse_BRS05, echo = FALSE, message = FALSE, warning = FALSE}

library(WaveletComp)

#Browse Island BRS05 site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

BRS05_joint_smooth <- BRS05_joint %>% 
  select(date, Site) %>% 
  add_column(
  browse_CCI = 
  analyze.wavelet(BRS05_joint, "browse_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$browse_CCI,
  browse_NOAA = 
  analyze.wavelet(BRS05_joint, "browse_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$browse_NOAA,
  browse_coral_core =
    analyze.wavelet(BRS05_joint, "browse_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$browse_coral_core,
  browse_GCM = 
    analyze.wavelet(BRS05_joint, "browse_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$browse_GCM)
# BRS05 CCI
#wave_out <- analyze.wavelet(BRS05_joint, "browse_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")



#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE
  
wave_out_CCI_CCORE <- 
  analyze.coherency(BRS05_joint_smooth, 
                    my.pair = c("browse_CCI", "browse_coral_core"), 
                    loess.span = 0,
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "browse_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "browse_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(BRS05_joint_smooth, 
                    my.pair = c("browse_NOAA", "browse_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "browse_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "browse_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE has a slightly higher power around period 1 than NOAA and CCORE.
# NOAA and CCORE has higher power around period 2 and 0.5. 

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(BRS05_joint_smooth, 
                    my.pair = c("browse_GCM", "browse_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE

par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 9, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 9, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 9, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a slightly higher correlation around period 1. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 3) +
  ggtitle("BRS05")
```

\newpage
**BRS07**  

```{r Frequency_Analysis_Browse_BRS07, echo = FALSE, message = FALSE, warning = FALSE}

#Browse Island BRS07 site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

BRS07_joint_smooth <- BRS07_joint %>% 
  select(date, Site) %>% 
  add_column(
  browse_CCI = 
  analyze.wavelet(BRS07_joint, "browse_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$browse_CCI,
  browse_NOAA = 
  analyze.wavelet(BRS07_joint, "browse_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$browse_NOAA,
  browse_coral_core =
    analyze.wavelet(BRS07_joint, "browse_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$browse_coral_core,
  browse_GCM = 
    analyze.wavelet(BRS07_joint, "browse_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$browse_GCM)


# BRS07 CCI
#wave_out <- analyze.wavelet(BRS07_joint, "browse_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(BRS07_joint_smooth, 
                    my.pair = c("browse_CCI", "browse_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "browse_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "browse_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(BRS07_joint_smooth, 
                    my.pair = c("browse_NOAA", "browse_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "browse_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "browse_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE has a slightly higher power around period 1 than NOAA and CCORE.
# NOAA and CCORE has similar power to CCI and CCORE around period 0.5, 2 and 4

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(BRS07_joint_smooth, 
                    my.pair = c("browse_GCM", "browse_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE

par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 10, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 10, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 10, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a slightly higher correlation around period 1. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 5) +
  ggtitle("BRS07")

```

\newpage
**DAR3**  

```{r Frequency_Analysis_Cocos_DAR3, echo = FALSE, message = FALSE, warning = FALSE}

#Cocos Island DAR3 site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

DAR3_joint_smooth <- DAR3_joint %>% 
  select(date, Site) %>% 
  add_column(
  Cocos_CCI = 
  analyze.wavelet(DAR3_joint, "Cocos_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$Cocos_CCI,
  Cocos_NOAA = 
  analyze.wavelet(DAR3_joint, "Cocos_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$Cocos_NOAA,
  Cocos_coral_core =
    analyze.wavelet(DAR3_joint, "Cocos_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$Cocos_coral_core,
  Cocos_GCM = 
    analyze.wavelet(DAR3_joint, "Cocos_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$Cocos_GCM)

#DAR3 CCI
#wave_out <- analyze.wavelet(DAR3_joint, "Cocos_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(DAR3_joint_smooth, 
                    my.pair = c("Cocos_CCI", "Cocos_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "Cocos_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "Cocos_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")


## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(DAR3_joint_smooth, 
                    my.pair = c("Cocos_NOAA", "Cocos_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "Cocos_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "Cocos_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE has a slightly higher power around period 1 than NOAA and CCORE.
# NOAA and CCORE has similar power to CCI and CCORE around period 2 to 4

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(DAR3_joint_smooth, 
                    my.pair = c("Cocos_GCM", "Cocos_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE

par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 10.5, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 10.5, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 10.5, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a slightly higher correlation around period 1. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 5) +
  ggtitle("DAR3")

```

\newpage
**DAR Long**  

```{r Frequency_Analysis_Cocos_DARL, echo = FALSE, message = FALSE, warning = FALSE}

#Cocos Island DARL site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

DARL_joint_smooth <- DARL_joint %>% 
  select(date, Site) %>% 
  add_column(
  Cocos_CCI = 
  analyze.wavelet(DARL_joint, "Cocos_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$Cocos_CCI,
  Cocos_NOAA = 
  analyze.wavelet(DARL_joint, "Cocos_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$Cocos_NOAA,
  Cocos_coral_core =
    analyze.wavelet(DARL_joint, "Cocos_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$Cocos_coral_core,
  Cocos_GCM = 
    analyze.wavelet(DARL_joint, "Cocos_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$Cocos_GCM)

#DARL CCI
#wave_out <- analyze.wavelet(DARL_joint, "Cocos_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(DARL_joint_smooth, 
                    my.pair = c("Cocos_CCI", "Cocos_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "Cocos_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "Cocos_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(DARL_joint_smooth, 
                    my.pair = c("Cocos_NOAA", "Cocos_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "Cocos_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "Cocos_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE has a slightly higher power than NOAA and CCORE around period 1.
# NOAA and CCORE has slightly higher power than CCI and CCORE around period 0.5

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(DARL_joint_smooth, 
                    my.pair = c("Cocos_GCM", "Cocos_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE

par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 10.5, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 10.5, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 10.5, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a similar correlation to NOAA and CCORE around period 1. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 5) +
  ggtitle("DAR Long")

```

\newpage
**Tantabiddi 13TNT**  

```{r Frequency_Analysis_Ningaloo_13TNT, echo = FALSE, message = FALSE, warning = FALSE}

#Tantabiddi 13TNT site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

Tantabiddi_13TNT_joint_smooth <- Tantabiddi_13TNT_joint %>% 
  select(date, Site) %>% 
  add_column(
  ningaloo_CCI = 
  analyze.wavelet(Tantabiddi_13TNT_joint, "ningaloo_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_CCI,
  ningaloo_NOAA = 
  analyze.wavelet(Tantabiddi_13TNT_joint, "ningaloo_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_NOAA,
  ningaloo_coral_core =
    analyze.wavelet(Tantabiddi_13TNT_joint, "ningaloo_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_coral_core,
  ningaloo_GCM = 
    analyze.wavelet(Tantabiddi_13TNT_joint, "ningaloo_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$ningaloo_GCM)

#13TNT CCI
#wave_out <- analyze.wavelet(Tantabiddi_13TNT_joint, "ningaloo_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(Tantabiddi_13TNT_joint_smooth, 
                    my.pair = c("ningaloo_CCI", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(Tantabiddi_13TNT_joint_smooth, 
                    my.pair = c("ningaloo_NOAA", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# NOAA and CCORE has a slightly higher power than CCI and CCORE around period 1.


#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(Tantabiddi_13TNT_joint_smooth, 
                    my.pair = c("ningaloo_GCM", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE

par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 14, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 14, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 14, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a similar correlation to NOAA and CCORE around period 0.5 and 1. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 3) +
  ggtitle("13TNT")

```

\newpage
**Tantabiddi 08TNT**  

```{r Frequency_Analysis_Ningaloo_08TNT, echo = FALSE, message = FALSE, warning = FALSE}

#Tantabiddi 08TNT site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis


Tantabiddi_08TNT_joint_smooth <- Tantabiddi_08TNT_joint %>% 
  select(date, Site) %>% 
  add_column(
  ningaloo_CCI = 
  analyze.wavelet(Tantabiddi_08TNT_joint, "ningaloo_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_CCI,
  ningaloo_NOAA = 
  analyze.wavelet(Tantabiddi_08TNT_joint, "ningaloo_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_NOAA,
  ningaloo_coral_core =
    analyze.wavelet(Tantabiddi_08TNT_joint, "ningaloo_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_coral_core,
  ningaloo_GCM = 
    analyze.wavelet(Tantabiddi_08TNT_joint, "ningaloo_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$ningaloo_GCM)

#08TNT CCI
#wave_out <- analyze.wavelet(Tantabiddi_08TNT_joint, "ningaloo_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(Tantabiddi_08TNT_joint_smooth, 
                    my.pair = c("ningaloo_CCI", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(Tantabiddi_08TNT_joint_smooth, 
                    my.pair = c("ningaloo_NOAA", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# NOAA and CCORE has a slightly higher power than CCI and CCORE around period 1.

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(Tantabiddi_08TNT_joint_smooth, 
                    my.pair = c("ningaloo_GCM", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE


par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 9.5, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 9.5, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 9.5, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a similar correlation to NOAA and CCORE around period 1 and 2. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 2.5) +
  ggtitle("08TNT")

```

\newpage
**Bundegi 13BND**  

```{r Frequency_Analysis_Ningaloo_13BND, echo = FALSE, message = FALSE, warning = FALSE}

#Bundegi 13BND site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis


Bundegi_13BND_joint_smooth <- Bundegi_13BND_joint %>% 
  select(date, Site) %>% 
  add_column(
  ningaloo_CCI = 
  analyze.wavelet(Bundegi_13BND_joint, "ningaloo_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_CCI,
  ningaloo_NOAA = 
  analyze.wavelet(Bundegi_13BND_joint, "ningaloo_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_NOAA,
  ningaloo_coral_core =
    analyze.wavelet(Bundegi_13BND_joint, "ningaloo_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_coral_core,
  ningaloo_GCM = 
    analyze.wavelet(Bundegi_13BND_joint, "ningaloo_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$ningaloo_GCM)

#13BND CCI
#wave_out <- analyze.wavelet(Bundegi_13BND_joint, "ningaloo_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(Bundegi_13BND_joint_smooth, 
                    my.pair = c("ningaloo_CCI", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(Bundegi_13BND_joint_smooth, 
                    my.pair = c("ningaloo_NOAA", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE has a much higher power than NOAA and CCORE around the peak (not at period 1 somehow).

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(Bundegi_13BND_joint_smooth, 
                    my.pair = c("ningaloo_GCM", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE


par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 9.5, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 9.5, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 9.5, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a much higher correlation than NOAA and CCORE around period 1. 

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 2) +
  ggtitle("13BND")

```

\newpage
**Bundegi 08BND**  

```{r Frequency_Analysis_Ningaloo_08BND, echo = FALSE, message = FALSE, warning = FALSE}

#Bundegi 08BND site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis


Bundegi_08BND_joint_smooth <- Bundegi_08BND_joint %>% 
  select(date, Site) %>% 
  add_column(
  ningaloo_CCI = 
  analyze.wavelet(Bundegi_08BND_joint, "ningaloo_CCI",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_CCI,
  ningaloo_NOAA = 
  analyze.wavelet(Bundegi_08BND_joint, "ningaloo_NOAA",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_NOAA,
  ningaloo_coral_core =
    analyze.wavelet(Bundegi_08BND_joint, "ningaloo_coral_core",
                            dt = 1/12,
                            dj = 1/10)$series$ningaloo_coral_core,
  ningaloo_GCM = 
    analyze.wavelet(Bundegi_08BND_joint, "ningaloo_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$ningaloo_GCM)

#08BND CCI
#wave_out <- analyze.wavelet(Bundegi_08BND_joint, "ningaloo_CCI",
#                            dt = 1/12,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner but 
# we got monthly data. So setting dt = 1/12 means 12 observation equalling one 
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(Bundegi_08BND_joint_smooth, 
                    my.pair = c("ningaloo_CCI", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(Bundegi_08BND_joint_smooth, 
                    my.pair = c("ningaloo_NOAA", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE has a much higher power than NOAA and CCORE around the peak (not at period 1 somehow).

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(Bundegi_08BND_joint_smooth, 
                    my.pair = c("ningaloo_GCM", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE


par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 13, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 13, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 13, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
# CCI and CCORE also appears to have a similar correlation to NOAA and CCORE at period 1. 
# NOAA and CCORE shows significant correlation as compared to CCI and CCORE which does not show correlation at period 2.

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 4) +
  ggtitle("08BND")

```
\newpage
\begin{center}

Annual Coral Core Proxy Sites -
Period of one represents 10 years

\end{center}

\newpage
**TNT07C**  

```{r Frequency_Analysis_Ningaloo_TNT07C, echo = FALSE, message = FALSE, warning = FALSE}

#TNT07C site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis


TNT07C_joint_smooth <- TNT07C_joint %>% 
  select(date, Site) %>% 
  add_column(
  ningaloo_CCI = 
  analyze.wavelet(TNT07C_joint, "ningaloo_CCI",
                            dt = 1/10,
                            dj = 1/10)$series$ningaloo_CCI,
  ningaloo_NOAA = 
  analyze.wavelet(TNT07C_joint, "ningaloo_NOAA",
                            dt = 1/10,
                            dj = 1/10)$series$ningaloo_NOAA,
  ningaloo_coral_core =
    analyze.wavelet(TNT07C_joint, "ningaloo_coral_core",
                            dt = 1/10,
                            dj = 1/10)$series$ningaloo_coral_core,
  ningaloo_GCM = 
    analyze.wavelet(TNT07C_joint, "ningaloo_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$ningaloo_GCM)

#TNT07C CCI
#wave_out <- analyze.wavelet(TNT07C_joint, "ningaloo_CCI",
#                            dt = 1/10,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner  
# we got annual data. So setting dt = 1 means 1 observation equalling one
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
#             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(TNT07C_joint_smooth, 
                    my.pair = c("ningaloo_CCI", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/10, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(TNT07C_joint_smooth, 
                    my.pair = c("ningaloo_NOAA", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/10, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# NOAA and CCORE and CCI and CCORE shows very low power

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(TNT07C_joint_smooth, 
                    my.pair = c("ningaloo_GCM", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE


par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 4, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 4, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 4, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
#  NOAA and CCORE shows significant correlation at period 0.5, whereas CCI and CCORE shows no significant correlation.

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 1) +
  ggtitle("TNT07C")

```

\newpage
**BUN05A**  

```{r Frequency_Analysis_Ningaloo_BUN05A, echo = FALSE, message = FALSE, warning = FALSE}

#BUN05A site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

BUN05A_joint_smooth <- BUN05A_joint %>% 
  select(date, Site) %>% 
  add_column(
  ningaloo_CCI = 
  analyze.wavelet(BUN05A_joint, "ningaloo_CCI",
                            dt = 1/10,
                            dj = 1/10)$series$ningaloo_CCI,
  ningaloo_NOAA = 
  analyze.wavelet(BUN05A_joint, "ningaloo_NOAA",
                            dt = 1/10,
                            dj = 1/10)$series$ningaloo_NOAA,
  ningaloo_coral_core =
    analyze.wavelet(BUN05A_joint, "ningaloo_coral_core",
                            dt = 1/10,
                            dj = 1/10)$series$ningaloo_coral_core,
  ningaloo_GCM = 
    analyze.wavelet(BUN05A_joint, "ningaloo_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$ningaloo_GCM)

#BUN05A CCI
#wave_out <- analyze.wavelet(BUN05A_joint, "ningaloo_CCI",
#                            dt = 1,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner  
# we got annual data. So setting dt = 1 means 1 observation equalling one
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  #geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
   #          data = ~ filter(.x, Power.avg.pval < 0.05)) + 
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(BUN05A_joint_smooth, 
                    my.pair = c("ningaloo_CCI", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(BUN05A_joint_smooth, 
                    my.pair = c("ningaloo_NOAA", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "ningaloo_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# NOAA and CCORE and CCI and CCORE shows very low power

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(BUN05A_joint_smooth, 
                    my.pair = c("ningaloo_GCM", "ningaloo_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE


par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 6.5, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 6.5, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 6.5, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
#  NOAA and CCORE shows significant correlation around period 0.4, whereas CCI and CCORE significant correlation around period 2 and 5.

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 1) +
  ggtitle("BUN05A")

```

\newpage
**HAB05B**  

```{r Frequency_Analysis_HAbrol_HAB05B, echo = FALSE, message = FALSE, warning = FALSE}

#Houtman Abrolhos HAB05B site
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore
# CCI and CCore and NOAA and CCore for bivariate analysis

HAB05B_SrCa_joint_smooth <- HAB05B_SrCa_joint %>% 
  select(date, Site) %>% 
  add_column(
  HAbrol_CCI = 
  analyze.wavelet(HAB05B_SrCa_joint, "HAbrol_CCI",
                            dt = 1/10,
                            dj = 1/10)$series$HAbrol_CCI,
  HAbrol_NOAA = 
  analyze.wavelet(HAB05B_SrCa_joint, "HAbrol_NOAA",
                            dt = 1/10,
                            dj = 1/10)$series$HAbrol_NOAA,
  HAbrol_coral_core =
    analyze.wavelet(HAB05B_SrCa_joint, "HAbrol_coral_core",
                            dt = 1/10,
                            dj = 1/10)$series$HAbrol_coral_core,
  HAbrol_GCM = 
    analyze.wavelet(HAB05B_SrCa_joint, "HAbrol_GCM",
                    dt = 1/12,
                    dj = 1/10)$series$HAbrol_GCM)

#HAB05B CCI
#wave_out <- analyze.wavelet(HAB05B_SrCa_joint, "HAbrol_CCI",
#                            dt = 1,
#                            dj = 1/10)
#wt.image(wave_out, n.levels = 250,
#         legend.params = list(lab = "wavelet power levels"),
#         show.date = TRUE, main = "CCI")
#wt.avg(wave_out, main = "CCI")

#loess.span = 0 if the series is detrended already
# otherwise, the algorithm will do the detrending for you. 
# Just use the default value would be fine. 
# dt = time resolution. We want to interpret things in yearly manner  
# we got annual data. So setting dt = 1 means 1 observation equalling one
# time unit which is a year. 
# dj = frequency resolution. Sampling resolution in the freq domain. 
# The default is to have 20 samples within each octave. 
# The avg power plot is in landscape mode. 
# This is great if you want to put it along side the wt.image plot 
# The avg power is what you get if you average all the values for each period 
# in the wt.image plot. 
# Obviously we can plot it ourselves

par(mfrow= c(1,2))
par(mar = c(3, 4, 3, 2))
par(cex = 0.6)
#wt.avg(wave_out, main = "CCI")
#wt.image(wave_out, n.levels = 250, show.date = TRUE, 
#         legend.params = list(mar = 7), main = "CCI")

# I tried all the tricks but the average power plot refused to be shown on the right. 
# Or if you just want the average power plot in ggplot format.
#ggplot(tibble(Period = wave_out$Period, 
#              Power.avg = wave_out$Power.avg,
#              Power.avg.pval = wave_out$Power.avg.pval)) + 
#  geom_line(aes(x = Period, y = Power.avg)) + 
#  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
#             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  #geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
   #          data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  #no points for pval significance 0.05
#  ylab("Average Wavelet Power") + 
#  scale_colour_discrete(name = "Sig. Level") +
#  ggtitle("CCI")

# the green dots are covered by the pinkish ones 

# bivariate wavelet analysis

## CCI and CCORE

wave_out_CCI_CCORE <- 
  analyze.coherency(HAB05B_SrCa_joint_smooth, 
                    my.pair = c("HAbrol_CCI", "HAbrol_coral_core"),
                    loess.span = 0, 
                    dt = 1, dj = 1/10)
wc.avg(wave_out_CCI_CCORE, main = "CCI and CCORE")

#Covariance
wc.image(wave_out_CCI_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "CCI and CCORE")
#Individual Series
#wt.image(wave_out_CCI_CCORE, my.series = "HAbrol_CCI", main = "CCI")
#wt.image(wave_out_CCI_CCORE, my.series = "HAbrol_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_CCI_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")
#add-on to correlation
wc.avg(wave_out_CCI_CCORE, which.avg = "wc",
       legend.coords = "topleft", 
       main = "CCI and Coral Core")
wc.image(wave_out_CCI_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "CCI and CCORE")

## NOAA and CCORE
wave_out_NOAA_CCORE <- 
  analyze.coherency(HAB05B_SrCa_joint_smooth, 
                    my.pair = c("HAbrol_NOAA", "HAbrol_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_NOAA_CCORE, main = "NOAA and CCORE")

#Covariance
wc.image(wave_out_NOAA_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "NOAA and CCORE")
#Individual Series
#wt.image(wave_out_NOAA_CCORE, my.series = "HAbrol_NOAA", main = "NOAA")
#wt.image(wave_out_NOAA_CCORE, my.series = "HAbrol_coral_core", main = "CCORE")
#Correlation
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
#         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")
#add-on to correlation
wc.avg(wave_out_NOAA_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "NOAA and Coral Core")
wc.image(wave_out_NOAA_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "NOAA and CCORE")

# cross-wavelet power (with certain limitations) to an assessment of the similarity of the two series’ wavelet power in the time-frequency (or time-scale) domain.
# CCI and CCORE shows very low power whereas NOAA and CCORE shows power 5 at period 0.3.

#GCM and CCORE
wave_out_GCM_CCORE <- 
  analyze.coherency(HAB05B_SrCa_joint_smooth, 
                    my.pair = c("HAbrol_GCM", "HAbrol_coral_core"),
                    loess.span = 0, 
                    dt = 1/12, dj = 1/10)
wc.avg(wave_out_GCM_CCORE, main = "GCM and CCORE")

#Covariance
wc.image(wave_out_GCM_CCORE, show.date = TRUE, 
         plot.arrow = FALSE, main = "GCM and CCORE")

wc.avg(wave_out_GCM_CCORE, which.avg = "wc",
       legend.coords = "topleft",
       main = "GCM and Coral Core")
wc.image(wave_out_GCM_CCORE, which.image = "wc", 
         show.date = TRUE, plot.arrow = FALSE, main = "GCM and CCORE")

#Compare CCI/NOAA/GCM vs CCORE


par(mfrow=c(3,1))
par(mar = c(3, 4, 1, 2))
par(cex = 0.6)
wc.avg(wave_out_CCI_CCORE, maximum.level = 6.5, main = "CCI and CCORE")
wc.avg(wave_out_NOAA_CCORE, maximum.level = 6.5, main = "NOAA and CCORE")
wc.avg(wave_out_GCM_CCORE, maximum.level = 6.5, main = "GCM and CCORE")

#par(mfrow=c(1,1))
#wc.image(wave_out_CCI_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "CCI and CCORE")
#wc.image(wave_out_NOAA_CCORE, which.image = "wc", show.date = TRUE, 
#         plot.arrow = FALSE, main = "NOAA and CCORE")
#  NOAA and CCORE shows significant correlation around period 0.4, whereas CCI and CCORE significant correlation around period 2 and 5.

## Plotting the two sets of average power together

temp <- tibble(Period = wave_out_CCI_CCORE$Period, 
              Power.avg = wave_out_CCI_CCORE$Power.xy.avg,
              Power.avg.pval = wave_out_CCI_CCORE$Power.xy.avg.pval, 
              type = "CCI and CCore") %>% 
         add_row(Period = wave_out_NOAA_CCORE$Period,
                  Power.avg = wave_out_NOAA_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_NOAA_CCORE$Power.xy.avg.pval,
                  type = "NOAA and CCore") %>% 
         add_row(Period = wave_out_GCM_CCORE$Period,
                  Power.avg = wave_out_GCM_CCORE$Power.xy.avg,
                  Power.avg.pval = wave_out_GCM_CCORE$Power.xy.avg.pval,
                  type = "GCM and CCore")

ggplot(temp) + 
  geom_line(aes(x = Period, y = Power.avg, colour = type)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.1"), 
             data = ~ filter(.x, Power.avg.pval < 0.1)) + 
  geom_point(aes(x = Period, y = Power.avg, colour = "0.05"), 
             data = ~ filter(.x, Power.avg.pval < 0.05)) + 
  ylab("Average Wavelet Power") + 
  scale_colour_discrete(name = "Sig. Level and Series") +
  xlim(0, 1) +
  ggtitle("HAB05B")

```


```{r Frequency_Analysis_Cocos, echo = FALSE, include = FALSE}
#previous method for analysing wavelets
library(dplR)
library(patchwork)
#Cocos (Keeling) Island
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore

#DAR3 CCI
wave.out <- morlet(y1 = DAR3_joint$Cocos_CCI, x1 = as.numeric(year(DAR3_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_DAR3_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_DAR3_CCI$period, wave.avg_DAR3_CCI$power, type = "l")

#DAR3 NOAA
wave.out <- morlet(y1 = DAR3_joint$Cocos_NOAA, x1 = as.numeric(year(DAR3_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_DAR3_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_DAR3_NOAA$period, wave.avg_DAR3_NOAA$power, type = "l")

#DAR3 Coral Core

wave.out <- morlet(y1 = DAR3_joint$Cocos_coral_core, x1 = as.numeric(year(DAR3_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_DAR3_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_DAR3_CCore$period, wave.avg_DAR3_CCore$power, type = "l")

#combined DAR3 plot
wave.avg_DAR3_Combined <- as_tibble(rbind(wave.avg_DAR3_CCI, wave.avg_DAR3_NOAA)) %>% 
  filter(period <= 10)

wave.avg_DAR3_CCore <- as_tibble(wave.avg_DAR3_CCore) %>% 
  filter(period <= 10)
DAR3_CCore <- ggplot(wave.avg_DAR3_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_DAR3_Combined$power) / max(wave.avg_DAR3_CCore$power))

#transform coral core data
wave.avg_DAR3_CCore <- wave.avg_DAR3_CCore %>% 
  mutate(power = power*coeff)

wave.avg_DAR3_Combined <- rbind(wave.avg_DAR3_Combined, wave.avg_DAR3_CCore)
  
DAR3_Sat <- ggplot(wave.avg_DAR3_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("DAR3 NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

DAR3_Sat / DAR3_CCore #plot using patchwork
  
#DARL CCI
wave.out <- morlet(y1 = DARL_joint$Cocos_CCI, x1 = as.numeric(year(DARL_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_DARL_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_DARL_CCI$period, wave.avg_DARL_CCI$power, type = "l")

#DARL NOAA
wave.out <- morlet(y1 = DARL_joint$Cocos_NOAA, x1 = as.numeric(year(DARL_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_DARL_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_DARL_NOAA$period, wave.avg_DARL_NOAA$power, type = "l")

#DARL Coral Core

wave.out <- morlet(y1 = DARL_joint$Cocos_coral_core, x1 = as.numeric(year(DARL_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_DARL_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_DARL_CCore$period, wave.avg_DARL_CCore$power, type = "l")

#combined DARL plot
wave.avg_DARL_Combined <- as_tibble(rbind(wave.avg_DARL_CCI, wave.avg_DARL_NOAA)) %>% 
  filter(period <= 10)

wave.avg_DARL_CCore <- as_tibble(wave.avg_DARL_CCore) %>% 
  filter(period <= 10)
DARL_CCore <- ggplot(wave.avg_DARL_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_DARL_Combined$power) / max(wave.avg_DARL_CCore$power))

#transform coral core data
wave.avg_DARL_CCore <- wave.avg_DARL_CCore %>% 
  mutate(power = power*coeff)

wave.avg_DARL_Combined <- rbind(wave.avg_DARL_Combined, wave.avg_DARL_CCore)
  
DARL_Sat <- ggplot(wave.avg_DARL_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("DARL NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

DARL_Sat / DARL_CCore #plot using patchwork

```

```{r Frequency_Analysis_Ningaloo, echo = FALSE, include = FALSE}
#previous method for analysing wavelets

#Ningaloo Reef
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore

#Tantabiddi 13TNT CCI
wave.out <- morlet(y1 = Tantabiddi_13TNT_joint$ningaloo_CCI, x1 = as.numeric(year(Tantabiddi_13TNT_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Tantabiddi_13TNT_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_Tantabiddi_13TNT_CCI$period, wave.avg_Tantabiddi_13TNT_CCI$power, type = "l")

#Tantabiddi 13TNT NOAA
wave.out <- morlet(y1 = Tantabiddi_13TNT_joint$ningaloo_NOAA, x1 = as.numeric(year(Tantabiddi_13TNT_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Tantabiddi_13TNT_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_Tantabiddi_13TNT_NOAA$period, wave.avg_Tantabiddi_13TNT_NOAA$power, type = "l")

#Tantabiddi 13TNT Coral Core

wave.out <- morlet(y1 = Tantabiddi_13TNT_joint$ningaloo_coral_core, x1 = as.numeric(year(Tantabiddi_13TNT_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_Tantabiddi_13TNT_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_Tantabiddi_13TNT_CCore$period, wave.avg_Tantabiddi_13TNT_CCore$power, type = "l")

#combined Tantabiddi 13TNT plot
wave.avg_Tantabiddi_13TNT_Combined <- as_tibble(rbind(wave.avg_Tantabiddi_13TNT_CCI, wave.avg_Tantabiddi_13TNT_NOAA)) %>% 
  filter(period <= 10)

wave.avg_Tantabiddi_13TNT_CCore <- as_tibble(wave.avg_Tantabiddi_13TNT_CCore) %>% 
  filter(period <= 10)
Tantabiddi_13TNT_CCore <- ggplot(wave.avg_Tantabiddi_13TNT_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_Tantabiddi_13TNT_Combined$power) / max(wave.avg_Tantabiddi_13TNT_CCore$power))

#transform coral core data
wave.avg_Tantabiddi_13TNT_CCore <- wave.avg_Tantabiddi_13TNT_CCore %>% 
  mutate(power = power*coeff)

wave.avg_Tantabiddi_13TNT_Combined <- rbind(wave.avg_Tantabiddi_13TNT_Combined, wave.avg_Tantabiddi_13TNT_CCore)
  
Tantabiddi_13TNT_Sat <- ggplot(wave.avg_Tantabiddi_13TNT_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("13TNT NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

Tantabiddi_13TNT_Sat / Tantabiddi_13TNT_CCore #plot using patchwork
  

#Tantabiddi 08TNT CCI
wave.out <- morlet(y1 = Tantabiddi_08TNT_joint$ningaloo_CCI, x1 = as.numeric(year(Tantabiddi_08TNT_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Tantabiddi_08TNT_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_Tantabiddi_08TNT_CCI$period, wave.avg_Tantabiddi_08TNT_CCI$power, type = "l")

#Tantabiddi 08TNT NOAA
wave.out <- morlet(y1 = Tantabiddi_08TNT_joint$ningaloo_NOAA, x1 = as.numeric(year(Tantabiddi_08TNT_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Tantabiddi_08TNT_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_Tantabiddi_08TNT_NOAA$period, wave.avg_Tantabiddi_08TNT_NOAA$power, type = "l")

#Tantabiddi 08TNT Coral Core

wave.out <- morlet(y1 = Tantabiddi_08TNT_joint$ningaloo_coral_core, x1 = as.numeric(year(Tantabiddi_08TNT_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_Tantabiddi_08TNT_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_Tantabiddi_08TNT_CCore$period, wave.avg_Tantabiddi_08TNT_CCore$power, type = "l")

#combined Tantabiddi 08TNT plot
wave.avg_Tantabiddi_08TNT_Combined <- as_tibble(rbind(wave.avg_Tantabiddi_08TNT_CCI, wave.avg_Tantabiddi_08TNT_NOAA)) %>% 
  filter(period <= 10)

wave.avg_Tantabiddi_08TNT_CCore <- as_tibble(wave.avg_Tantabiddi_08TNT_CCore) %>% 
  filter(period <= 10)
Tantabiddi_08TNT_CCore <- ggplot(wave.avg_Tantabiddi_08TNT_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_Tantabiddi_08TNT_Combined$power) / max(wave.avg_Tantabiddi_08TNT_CCore$power))

#transform coral core data
wave.avg_Tantabiddi_08TNT_CCore <- wave.avg_Tantabiddi_08TNT_CCore %>% 
  mutate(power = power*coeff)

wave.avg_Tantabiddi_08TNT_Combined <- rbind(wave.avg_Tantabiddi_08TNT_Combined, wave.avg_Tantabiddi_08TNT_CCore)
  
Tantabiddi_08TNT_Sat <- ggplot(wave.avg_Tantabiddi_08TNT_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("08TNT NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

Tantabiddi_08TNT_Sat / Tantabiddi_08TNT_CCore #plot using patchwork

#Bundegi 13BND CCI
wave.out <- morlet(y1 = Bundegi_13BND_joint$ningaloo_CCI, x1 = as.numeric(year(Bundegi_13BND_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Bundegi_13BND_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_Bundegi_13BND_CCI$period, wave.avg_Bundegi_13BND_CCI$power, type = "l")

#Bundegi 13BND NOAA
wave.out <- morlet(y1 = Bundegi_13BND_joint$ningaloo_NOAA, x1 = as.numeric(year(Bundegi_13BND_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Bundegi_13BND_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_Bundegi_13BND_NOAA$period, wave.avg_Bundegi_13BND_NOAA$power, type = "l")

#Bundegi 13BND Coral Core

wave.out <- morlet(y1 = Bundegi_13BND_joint$ningaloo_coral_core, x1 = as.numeric(year(Bundegi_13BND_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_Bundegi_13BND_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_Bundegi_13BND_CCore$period, wave.avg_Bundegi_13BND_CCore$power, type = "l")

#combined Bundegi 13BND plot
wave.avg_Bundegi_13BND_Combined <- as_tibble(rbind(wave.avg_Bundegi_13BND_CCI, wave.avg_Bundegi_13BND_NOAA)) %>% 
  filter(period <= 10)

wave.avg_Bundegi_13BND_CCore <- as_tibble(wave.avg_Bundegi_13BND_CCore) %>% 
  filter(period <= 10)
Bundegi_13BND_CCore <- ggplot(wave.avg_Bundegi_13BND_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_Bundegi_13BND_Combined$power) / max(wave.avg_Bundegi_13BND_CCore$power))

#transform coral core data
wave.avg_Bundegi_13BND_CCore <- wave.avg_Bundegi_13BND_CCore %>% 
  mutate(power = power*coeff)

wave.avg_Bundegi_13BND_Combined <- rbind(wave.avg_Bundegi_13BND_Combined, wave.avg_Bundegi_13BND_CCore)
  
Bundegi_13BND_Sat <- ggplot(wave.avg_Bundegi_13BND_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("13BND NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

Bundegi_13BND_Sat / Bundegi_13BND_CCore #plot using patchwork
  
#Bundegi 08BND CCI
wave.out <- morlet(y1 = Bundegi_08BND_joint$ningaloo_CCI, x1 = as.numeric(year(Bundegi_08BND_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Bundegi_08BND_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_Bundegi_08BND_CCI$period, wave.avg_Bundegi_08BND_CCI$power, type = "l")

#Bundegi 08BND NOAA
wave.out <- morlet(y1 = Bundegi_08BND_joint$ningaloo_NOAA, x1 = as.numeric(year(Bundegi_08BND_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_Bundegi_08BND_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_Bundegi_08BND_NOAA$period, wave.avg_Bundegi_08BND_NOAA$power, type = "l")

#Bundegi 08BND Coral Core

wave.out <- morlet(y1 = Bundegi_08BND_joint$ningaloo_coral_core, x1 = as.numeric(year(Bundegi_08BND_joint$date)), dj = 0.1, siglvl = 0.95)
wave.out$period <- wave.out$period/12
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_Bundegi_08BND_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_Bundegi_08BND_CCore$period, wave.avg_Bundegi_08BND_CCore$power, type = "l")

#combined Bundegi 08BND plot
wave.avg_Bundegi_08BND_Combined <- as_tibble(rbind(wave.avg_Bundegi_08BND_CCI, wave.avg_Bundegi_08BND_NOAA)) %>% 
  filter(period <= 10)

wave.avg_Bundegi_08BND_CCore <- as_tibble(wave.avg_Bundegi_08BND_CCore) %>% 
  filter(period <= 10)
Bundegi_08BND_CCore <- ggplot(wave.avg_Bundegi_08BND_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_Bundegi_08BND_Combined$power) / max(wave.avg_Bundegi_08BND_CCore$power))

#transform coral core data
wave.avg_Bundegi_08BND_CCore <- wave.avg_Bundegi_08BND_CCore %>% 
  mutate(power = power*coeff)

wave.avg_Bundegi_08BND_Combined <- rbind(wave.avg_Bundegi_08BND_Combined, wave.avg_Bundegi_08BND_CCore)
  
Bundegi_08BND_Sat <- ggplot(wave.avg_Bundegi_08BND_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("08BND NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

Bundegi_08BND_Sat / Bundegi_08BND_CCore #plot using patchwork

#TNT07C CCI
wave.out <- morlet(y1 = TNT07C_joint$ningaloo_CCI, x1 = as.numeric(year(TNT07C_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12 
#not necessary because dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_TNT07C_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_TNT07C_CCI$period, wave.avg_TNT07C_CCI$power, type = "l")

#TNT07C NOAA
wave.out <- morlet(y1 = TNT07C_joint$ningaloo_NOAA, x1 = as.numeric(year(TNT07C_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary because dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_TNT07C_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_TNT07C_NOAA$period, wave.avg_TNT07C_NOAA$power, type = "l")

#TNT07C Coral Core

wave.out <- morlet(y1 = TNT07C_joint$ningaloo_coral_core, x1 = as.numeric(year(TNT07C_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary because dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_TNT07C_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_TNT07C_CCore$period, wave.avg_TNT07C_CCore$power, type = "l")

#combined TNT07C plot
wave.avg_TNT07C_Combined <- as_tibble(rbind(wave.avg_TNT07C_CCI, wave.avg_TNT07C_NOAA)) %>% 
  filter(period <= 10)

wave.avg_TNT07C_CCore <- as_tibble(wave.avg_TNT07C_CCore) %>% 
  filter(period <= 10)
TNT07C_CCore <- ggplot(wave.avg_TNT07C_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_TNT07C_Combined$power) / max(wave.avg_TNT07C_CCore$power))

#transform coral core data
wave.avg_TNT07C_CCore <- wave.avg_TNT07C_CCore %>% 
  mutate(power = power*coeff)

wave.avg_TNT07C_Combined <- rbind(wave.avg_TNT07C_Combined, wave.avg_TNT07C_CCore)
  
TNT07C_Sat <- ggplot(wave.avg_TNT07C_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("TNT07C NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

TNT07C_Sat / TNT07C_CCore #plot using patchwork


#BUN05A CCI
wave.out <- morlet(y1 = BUN05A_joint$ningaloo_CCI, x1 = as.numeric(year(BUN05A_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12 
#not necessary because dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_BUN05A_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_BUN05A_CCI$period, wave.avg_BUN05A_CCI$power, type = "l")

#BUN05A NOAA
wave.out <- morlet(y1 = BUN05A_joint$ningaloo_NOAA, x1 = as.numeric(year(BUN05A_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary because dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_BUN05A_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_BUN05A_NOAA$period, wave.avg_BUN05A_NOAA$power, type = "l")

#BUN05A Coral Core

wave.out <- morlet(y1 = BUN05A_joint$ningaloo_coral_core, x1 = as.numeric(year(BUN05A_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary because dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_BUN05A_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_BUN05A_CCore$period, wave.avg_BUN05A_CCore$power, type = "l")

#combined BUN05A plot
wave.avg_BUN05A_Combined <- as_tibble(rbind(wave.avg_BUN05A_CCI, wave.avg_BUN05A_NOAA)) %>% 
  filter(period <= 10)

wave.avg_BUN05A_CCore <- as_tibble(wave.avg_BUN05A_CCore) %>% 
  filter(period <= 10)
BUN05A_CCore <- ggplot(wave.avg_BUN05A_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_BUN05A_Combined$power) / max(wave.avg_BUN05A_CCore$power))

#transform coral core data
wave.avg_BUN05A_CCore <- wave.avg_BUN05A_CCore %>% 
  mutate(power = power*coeff)

wave.avg_BUN05A_Combined <- rbind(wave.avg_BUN05A_Combined, wave.avg_BUN05A_CCore)
  
BUN05A_Sat <- ggplot(wave.avg_BUN05A_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("BUN05A NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

BUN05A_Sat / BUN05A_CCore #plot using patchwork

```

```{r Frequency_Analysis_Houtman_Abrol, echo = FALSE, include = FALSE}
#previous method for analysing wavelets

#Houtman Abrolhos Island
#use _joint file with combined SST/Proxy values from NOAA, CCI and CCore

#HAB05B SrCa CCI
wave.out <- morlet(y1 = HAB05B_SrCa_joint$HAbrol_CCI, x1 = as.numeric(year(HAB05B_SrCa_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary as dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_HAB05B_SrCa_CCI <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "CCI")
#plot(wave.avg_HAB05B_SrCa_CCI$period, wave.avg_HAB05B_SrCa_CCI$power, type = "l")

#HAB05B SrCa NOAA
wave.out <- morlet(y1 = HAB05B_SrCa_joint$HAbrol_NOAA, x1 = as.numeric(year(HAB05B_SrCa_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary as dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))


wave.avg_HAB05B_SrCa_NOAA <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "NOAA")
#plot(wave.avg_HAB05B_SrCa_NOAA$period, wave.avg_HAB05B_SrCa_NOAA$power, type = "l")

#HAB05B SrCa Coral Core

wave.out <- morlet(y1 = HAB05B_SrCa_joint$HAbrol_coral_core, x1 = as.numeric(year(HAB05B_SrCa_joint$date)), dj = 0.1, siglvl = 0.95)
#wave.out$period <- wave.out$period/12
#not necessary as dataset is annual
leand <- quantile(wave.out$Power, c(0, 0.25, 0.5, 0.75, 0.95, 1))

wave.avg_HAB05B_SrCa_CCore <- data.frame(power = apply(wave.out$Power, 2, mean), period = (wave.out$period), Type = "Coral Core")
#plot(wave.avg_HAB05B_SrCa_CCore$period, wave.avg_HAB05B_SrCa_CCore$power, type = "l")

#combined HAB05B SrCa plot
wave.avg_HAB05B_SrCa_Combined <- as_tibble(rbind(wave.avg_HAB05B_SrCa_CCI, wave.avg_HAB05B_SrCa_NOAA)) %>% 
  filter(period <= 10)

wave.avg_HAB05B_SrCa_CCore <- as_tibble(wave.avg_HAB05B_SrCa_CCore) %>% 
  filter(period <= 10)
HAB05B_SrCa_CCore <- ggplot(wave.avg_HAB05B_SrCa_CCore) +
  geom_line(aes(x = period, y = power, color = Type)) +
  scale_color_manual(values = "brown")

#setting value to transform coral core data 
coeff <- (max(wave.avg_HAB05B_SrCa_Combined$power) / max(wave.avg_HAB05B_SrCa_CCore$power))

#transform coral core data
wave.avg_HAB05B_SrCa_CCore <- wave.avg_HAB05B_SrCa_CCore %>% 
  mutate(power = power*coeff)

wave.avg_HAB05B_SrCa_Combined <- rbind(wave.avg_HAB05B_SrCa_Combined, wave.avg_HAB05B_SrCa_CCore)
  
HAB05B_SrCa_Sat <- ggplot(wave.avg_HAB05B_SrCa_Combined) +
  geom_line(aes(x = period, y = power, color = Type)) +
  ggtitle("HAB05B NOAA, CCI and Adjusted Coral Core SST Time Series Power") +
  scale_y_continuous(
    name = "NOAA and CCI Power",
    sec.axis = sec_axis(~./coeff, name = "Coral Core Power")
  )

HAB05B_SrCa_Sat / HAB05B_SrCa_CCore #plot using patchwork

```